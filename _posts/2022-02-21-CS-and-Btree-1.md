---
title:  "소프트웨어 개발자에게 전공 지식이 필요한가? (B tree이야기) #1"
date:   2022-02-21
categories: [post]
tags:
- post
- notion
- dev
- 잡설
---
## 잡설

학부 시절 알고리즘 과목을 배우면서 참 많이 고통 받았던 기억이 있다. 컴퓨터공학 전공을 한 사람들은 공감하겠지만 컴퓨터공학 2~3학년 때 참 힘든 시간을 보내게 된다. 보통 그 시기에 데이터구조, 운영체제, 알고리즘, PL(Programming Language) 등을 배우게 된다. 나는 Stack, Queue, Linked List 등을 이용해서 여러 알고리즘을 직접 구현하면서 학기를 보내고 있었는데 학기말을 앞둔 마지막 수업에서 배웠던게 B tree와 red-black tree이다. 아직도 기억나는게 아주 더운 학기말 교수님께서는 기말고사 시험을 준비하며 지쳐있는 학생들을 보면서 안타까우셨는지 이런 말씀을 하셨다. 

*“앞으로 소개할 B tree, red-black tree는 앞으로 여러분들이 실무 일을 하면서 구현할 일은 없을거다. 그렇기 때문에 이 부분은 기말고사에 내지 않겠다.”*

얼마나 가뭄에 단비같은 말이었는지 딱 저말까지만 기억하고 그 뒤에 수업은 기억이 나지 않는다. 아마 바로 정신을 잃고 잠에 빠졌던 것 같다.  
![image](https://user-images.githubusercontent.com/6336815/155447280-eddfa689-8325-4957-9623-dc2459a39a84.png)

그뒤로 8년가량 개발을 하고 있지만 정말로 실무일을 하면서 B Tree나 red-black tree에 대해 고민해 본적이 없다. 심지어 코딩테스트 알고리즘 시험에서도 써본적이 없다. 단 한번 8년전 봤던 신입직원 면접에서 B tree와 red-black tree에 대해 간략하게 설명할 수 있겠냐는 질문을 받아봤을 뿐이다. 역설적이게도 일부러 공부를 하지 않은 부분이라 내가 모른다는걸 명확하게 알았기 때문에 당당하게 대답할 수 있었다.

*“모릅니다”*

다행히 다른 질문들은 잘 대답했는지 합격할 수 있었고, 정말 가고 싶던 회사였지만 고심끝에 S전자에 입사하기로 하고 입사 포기 메일을 보냈다. 그렇게 이 일은 지금까지 내 머리속에서 잊혀져 있었다.

## 나는 왜 이제와서 B tree를 찾아보는가?

`“전공 지식이 있어야 실무를 할 수 있는가?”` 에 대답은 `“No”` 일 것 같다. 그런데 일을 하다보니 전공지식을 알고 있으면 일을 하는데 분명 도움이 된다. 그런데 질문을 바꿔서 `“전공 지식이 없어도 실무를 잘 할 수 있는가?”` 라고 물으면 이 또한 `“No”`로 대답할 수 밖에 없다. 이번에 B tree를 다시 공부하게 된 과정은 아래와 같다.

1. 현업에서 서버 부하가 DB에 몰린다. (On premise)
2. 상대적으로 WAS와 네트워크 대역에는 여유가 있다.
3. 즉, DB 에서 걸리는 보틀넥(bottle neck)을 해결해야 한다.
4. 해결책으로 떠오를 수 있는건 
    1. scale up, scale out 등 물리적인 DB 성능을 높인다.
    2. NoSQL 사용을 검토한다. (Redis, MongoDB 등)
    3. **쿼리를 튜닝한다.**
    
    등이다.
    


*scale out, serverless 등은 큰 의미가 없다고 판단했다. WAS 성능 문제가 아니기 때문이다.*


 개인적으로 이런 상황에서 가장 좋은 방법은 물리적인 DB 성능을 높이는게 답이라고 생각한다. 현재 현업에서 비용의 문제로 Tibero DB를 사용중이다. 그렇기 때문에 가격은 비싸지만 성능이 확실히 보장되는 Oracle DB로 바꾸거나  DB서버 자체를 scale up 하는 것도 답이 될 수 있다. 개발자 인건비가 비교적 낮았던 과거에는 개발자나 DBA를 통해 서버 성능을 개선했지만 인건비가 말도 안되게 높아지고 있는 지금은 확실하게 HW성능을 높이는게 훨씬 합리적일 수 있다.

 하지만 그렇다고 언제까지 HW 탓만 할수는 없지 않은가? `DBA를 통해 쿼리를 튜닝한다`.  쉽고 빠른 방법이 있고, 어느정도 쿼리 튜닝은 스스로 할 수 있다. 결론부터 말하자면 이미 답도 알고 있다.

*현재 겪고 있는 DB 성능 저하는 Insert 쿼리로부터 비롯된다. 비즈니스 로직상으로 보나 Jennifer, DB excution plan 등을 분석하나 명확하다. 현재 사용중인 DB에 index가 잡혀있는데 `index를 없애면 insert 성능이 향상`될 것이다. index는 조회 성능을 비약적으로 상승시켜주지만 CUD 성능, 특히 insert 시 성능 저하를 일으킬 가능성이 매우 높다.*

이렇게 문제 하나 해결! 하고 넘어가면 좋겠지만 여기서 궁금증이 생겼다. `“Why?”`


그냥 `index는 insert 성능을 저하시킨다` 는 상식적인 결론보다 `“Why?”`가 궁금했다. 그 `"Why?”`에 대한 답을 찾다보니 8년전 대학교 3학년 학부시절 배웠던 B tree가 튀어나왔다.